name: Simple Download and Release

on:
  workflow_dispatch:
    inputs:
      download_url:
        description: 'URL do arquivo para download'
        required: true
        type: string
      aria2_options:
        description: 'Opções do aria2c'
        required: false
        type: string
        default: '--continue=true --max-tries=0'

jobs:
  simple-download:
    runs-on: ubuntu-latest
    
    steps:
    - name: Setup
      run: sudo apt-get update && sudo apt-get install -y aria2

    - name: Download with aria2 (preserve original name)
      id: download
      run: |
        echo "Baixando: ${{ inputs.download_url }}"
        
        # Baixar SEM especificar nome de saída
        # O aria2c usará o nome do servidor
        aria2c ${{ inputs.aria2_options }} "${{ inputs.download_url }}"
        
        # Encontrar qual arquivo foi baixado
        # O aria2c geralmente mantém o nome original
        echo "Arquivos na pasta:"
        ls -la
        
        # Pegar o arquivo mais recente (provavelmente o que acabou de baixar)
        FILENAME=$(ls -1t | head -1)
        
        # Verificar se é um arquivo (não diretório)
        if [ ! -f "$FILENAME" ]; then
          # Tentar encontrar qualquer arquivo
          FILENAME=$(find . -maxdepth 1 -type f -printf "%f\n" | head -1)
        fi
        
        if [ -z "$FILENAME" ] || [ ! -f "$FILENAME" ]; then
          echo "ERRO: Nenhum arquivo encontrado após download!"
          exit 1
        fi
        
        echo "Arquivo baixado: $FILENAME"
        echo "Tamanho: $(ls -lh "$FILENAME")"
        echo "filename=$FILENAME" >> $GITHUB_OUTPUT

    - name: Create release with auto tag
      uses: softprops/action-gh-release@v1
      with:
        tag_name: "file-$(date +%s)"
        name: "Download: ${{ steps.download.outputs.filename }}"
        body: "Baixado de: ${{ inputs.download_url }}"
        files: ${{ steps.download.outputs.filename }}
